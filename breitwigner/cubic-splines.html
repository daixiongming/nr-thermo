---
layout:  post
title:   "Cubic Spline interpolation"
stitle:  "Cubic Splines"
date:    2005-04-04 00:11:16
---

			<p>Cubic Spline interpolation between each data pair <strong>x<sub>i</sub></strong>, <strong>x<sub>i+1</sub></strong> is done through a third-grade polynomial function, under the condition that the function <strong>f(x)</strong>, as well as its first and second derivatives <strong>f(x)<sup>1</sup></strong> and <strong>f(x)<sup>2</sup></strong>, have to be continuum in the limits of the interval.</p>


			<!-- LATEX: x_i\leq x\leq x_{i+1} -->
			<p class="center"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mi>i</mi></msub><mo>&#8804;</mo><mi>x</mi><mo>&#8804;</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></math></p>

			<!-- LATEX: f_i(x)=f_i(x_i)+(x-x_i)f_i^1(x)+\frac12(x-x_i)^2f_i^2(x_i)+\frac16(x-x_i)^3f_i^3(x_i) -->
			<p class="center"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>f</mi><mi>i</mi></msub><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><msub><mi>f</mi><mi>i</mi></msub><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>)</mo><mo>+</mo><mo>(</mo><mi>x</mi><mo>-</mo><msub><mi>x</mi><mi>i</mi></msub><mo>)</mo><msubsup><mi>f</mi><mi>i</mi><mn>1</mn></msubsup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>(</mo><mi>x</mi><mo>-</mo><msub><mi>x</mi><mi>i</mi></msub><msup><mo>)</mo><mn>2</mn></msup><msubsup><mi>f</mi><mi>i</mi><mn>2</mn></msubsup><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>)</mo><mo>+</mo><mfrac><mn>1</mn><mn>6</mn></mfrac><mo>(</mo><mi>x</mi><mo>-</mo><msub><mi>x</mi><mi>i</mi></msub><msup><mo>)</mo><mn>3</mn></msup><msubsup><mi>f</mi><mi>i</mi><mn>3</mn></msubsup><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>)</mo></math></p>

			<p>and, if the third-order derivative is written as a function of the second-order derivative,</p>

			<!-- LATEX: f_i(x)=f_i(x_i)+(x-x_i)f_i^1(x)+\frac12(x-x_i)^2f_i^2(x_i)+\frac1{6h}(x-x_i)^3\left(f_i^2(x_{i+1})-f_i^2(x_i)\right)-->
			<p class="center"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>f</mi><mi>i</mi></msub><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><msub><mi>f</mi><mi>i</mi></msub><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>)</mo><mo>+</mo><mo>(</mo><mi>x</mi><mo>-</mo><msub><mi>x</mi><mi>i</mi></msub><mo>)</mo><msubsup><mi>f</mi><mi>i</mi><mn>1</mn></msubsup><mo>(</mo><mi>x</mi><mo>)</mo><mo>+</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>(</mo><mi>x</mi><mo>-</mo><msub><mi>x</mi><mi>i</mi></msub><msup><mo>)</mo><mn>2</mn></msup><msubsup><mi>f</mi><mi>i</mi><mn>2</mn></msubsup><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>)</mo><mo>+</mo><mfrac><mn>1</mn><mrow><mn>6</mn><mi>h</mi></mrow></mfrac><mo>(</mo><mi>x</mi><mo>-</mo><msub><mi>x</mi><mi>i</mi></msub><msup><mo>)</mo><mn>3</mn></msup><mfenced><mrow><msubsup><mi>f</mi><mi>i</mi><mn>2</mn></msubsup><mo>(</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>)</mo><mo>-</mo><msubsup><mi>f</mi><mi>i</mi><mn>2</mn></msubsup><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>)</mo></mrow></mfenced></math></p>

			<p>where <em>h</em> is:</p>

			<!-- LATEX: x_{i+1} = x_i + h -->
			<p class="center"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><mi>h</mi></math></p>

			<p>and the continuity conditions:</p>

			<!-- LATEX: \begin{array}{c}
f_i(x_{i+1}) = f_{i+1}(x_{i+1})\\
f_i^1(x_{i+1}) = f_{i+1}^1(x_{i+1})\\
f_i^2(x_{i+1}) = f_{i+1}^2(x_{i+1})
\end{array} -->
			<p class="center"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtable><mtr><mtd><msub><mi>f</mi><mi>i</mi></msub><mo>(</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>)</mo><mo>=</mo><msub><mi>f</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>(</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>)</mo></mtd></mtr><mtr><mtd><msubsup><mi>f</mi><mi>i</mi><mn>1</mn></msubsup><mo>(</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>)</mo><mo>=</mo><msubsup><mi>f</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow><mn>1</mn></msubsup><mo>(</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>)</mo></mtd></mtr><mtr><mtd><msubsup><mi>f</mi><mi>i</mi><mn>2</mn></msubsup><mo>(</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>)</mo><mo>=</mo><msubsup><mi>f</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow><mn>2</mn></msubsup><mo>(</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>)</mo></mtd></mtr></mtable></math></p>

			<aside class="important">
				<h2>Library functions (<em>Numerical Recipes</em>):</h2>
				<dl>
					<dt><strong><em>spline()</em>:</strong><a id="spline" class="def" href="#function1"><span class="visuallyhidden">Go to function call</span></a></dt>
					<dd>it takes six arguments; vectors <code>x[]</code>, <code>y[]</code> (<em>which contain the experimental points between which the interpolation will take place</em>), the number of data points <code>n</code>,  the variables <code>yp1</code> and <code>ypn</code> (<em>which contain the values of the first derivative in the first point x<sub>i</sub> and in the last one x<sub>N</sub>, respectively</em>), and the vector <code>y2[]</code> (<em>which returns the second order derivatives in each of the x<sub>i</sub> points</em>).
</dd>
					<dt><strong><em>splint()</em>:</strong><a id="splint" class="def" href="#function2"><span class="visuallyhidden">Go to function call</span></a></dt>
					<dd>it takes six arguments; vectors <code>xa[]</code>, <code>ya[]</code> (<em>which contain the experimental points between which the interpolation will take place</em>), the vector <code>y2a[]</code> (<em>which returns the second order derivatives in each of the x<sub>i</sub> points, obtained from <strong>spline()</strong></em>), the number of data points <code>n</code>, the variable <code>x</code> (<em>which is the abscissa for which we want to interpolate</em>), and the variable <code>y</code> (<em>used to return the  the interpolated value</em>).
</dd>
				</dl>
			</aside>

			<p>The files for this calculation are in folder <code>breitwigner/2_CubicSplines</code>. It uses the Numerical Recipes libraries, <code>spline.c</code> and <code>splint.c</code>.</p>

			<p>The program <code>splinesc.c</code> is very similar to <code>lagrange.c</code> and works in a similar way as explained in the <a href="{{ site.url }}/{{ page.dir }}/lagrange-interpolators.html">Lagrange interpolations</a> page.</p>

			<p>Once we have all the inputs, we can call the <code>spline()</code> function (you may want to check <a id="function1" href="#spline">the definition</a> again) and then we call <code>splint()</code> inside a loop through the points (See <a id="function2" href="#splint">the definition</a>).</p>

<pre class="line-numbers" data-start="160"><code class="language-c">	/***************************************************
	 * Calculating the first derivative,
	 * evaluating in E1 and E1 and
	 * calling the functions
	 ***************************************************/
	yp1 = -0,00001;
	ypn = -0,5;
	
	spline(xa, ya, N, yp1, ypn, y2);
	for (i=1; i<=n; i++)
		splint(xa, ya, y2, N, x[i], &y[i]);</code></pre>

			<h2>Results</h2>

			<p>And so the following values are obtained:</p>

			<ul class="itemslist">
				<li><strong>&sigma;<sub>0</sub> = 70297.063</strong></li>
				<li><strong><em>E<sub>r</sub></em> = 76.100 MeV</strong></li> 
				<li><strong>&gamma; = 57.986 MeV</strong></li>
			</ul>

			<p>The region of the curve where there is more variation is the peak, that's why we take more points there. Repeat the calculation adding points for the rest of the curve.</p>

			<p class="center"><img src="{{ '/img/breitWigner-splines1.png' | prepend: site.baseurl }}" width="621" height="349" alt="Breit-Wigner curve obtained with Cubic splines"></p>
			<p class="center small">The peak is the region of higher variation of the curve.</p>

			<p class="center"><img src="{{ '/img/breitWigner-splines2.png' | prepend: site.baseurl }}" width="622" height="350" alt="Breit-Wigner curve obtained with Cubic splines. Zoom in"></p>
			<p class="center small">Zoom in of the previous plot.</p>
